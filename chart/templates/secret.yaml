{{- if eq .Values.secretType "secret" }}
apiVersion: v1
kind: Secret
{{- else if eq .Values.secretType "sealedSecret" }}
apiVersion: bitnami.com/v1alpha1
kind: SealedSecret
{{- end }}
metadata:
  name: {{ include "joy-generator.fullname" . }}-config
{{- if eq .Values.secretType "secret" }}
stringData:
  JOY_PLUGIN_TOKEN: "{{ required "pluginToken is required" .Values.applicationConfig.pluginToken }}"
  JOY_REPO_URL: "{{ required "repoUrl is required" .Values.applicationConfig.repoUrl }}"
  {{- if .Values.applicationConfig.githubApp }}
  JOY_GITHUB_APP_ID: "{{ required "github app id is required" .Values.applicationConfig.githubApp.appId }}"
  JOY_GITHUB_APP_INSTALLATION_ID: "{{ required "github app installation id is required" .Values.applicationConfig.githubApp.installationId }}"
  {{- else }}
  JOY_GITHUB_TOKEN: "{{ required "either a github token or github app is required" .Values.applicationConfig.githubToken }}"
  {{- end }}
{{- else if eq .Values.secretType "sealedSecret" }}
spec:
  encryptedData:
    JOY_PLUGIN_TOKEN: "{{ required "pluginToken is required" .Values.applicationConfig.pluginToken }}"
    JOY_REPO_URL: "{{ required "repoUrl is required" .Values.applicationConfig.repoUrl }}"
    {{- if .Values.applicationConfig.githubApp }}
    JOY_GITHUB_APP_ID: "{{ required "github app id is required" .Values.applicationConfig.githubApp.appId }}"
    JOY_GITHUB_APP_INSTALLATION_ID: "{{ required "github app installation id is required" .Values.applicationConfig.githubApp.installationId }}"
    {{- else }}
    JOY_GITHUB_TOKEN: "{{ required "either a github token or github app is required" .Values.applicationConfig.githubToken }}"
    {{- end }}
{{- end }}

---
{{- if .Values.applicationConfig.githubApp }}
{{- if eq .Values.secretType "secret" }}
apiVersion: v1
kind: Secret
{{- else if eq .Values.secretType "sealedSecret" }}
apiVersion: bitnami.com/v1alpha1
kind: SealedSecret
{{- end }}
metadata:
  name: {{ include "joy-generator.fullname" . }}-github-app-key
{{- if eq .Values.secretType "secret" }}
stringData:
  githubApp.pem: |
{{ required "github app private key is required" .Values.applicationConfig.githubApp.privateKey | indent 4 }}
{{- else if eq .Values.secretType "sealedSecret" }}
spec:
  encryptedData:
    githubApp.pem: |
{{ required "github app private key is required" .Values.applicationConfig.githubApp.privateKey | indent 6 }}
{{- end }}
{{- end }}
